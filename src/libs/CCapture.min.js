function CCapture(b){function k(){f("Incrementing time");d+=h;l++;for(var a=0;a<c.length;a++)d>=c[a].triggerTime&&(c[a].callback(),console.log("timeout!"),c.splice(a,1));e&&e()}function f(a){i&&console.log(a)}var b=b||{},m=new Date,i,d,h,c=[],l=0,e=null,g=!1;b.framerate=b.framerate||60;i=b.verbose||!1;h=1E3/b.framerate;var j=new Whammy.Video(b.framerate),n=requestAnimationFrame;(function(){f("Capturer start");d=m.getTime();Date.prototype.getTime=function(){return d};Date.now=function(){return d};
setTimeout=function(a,b){var e={callback:a,time:b,triggerTime:d+b};c.push(e);f("Timeout set to "+e.time);return e};clearTimeout=function(a){for(var b=0;b<c.length;b++)c[b]==a&&(c.splice(b,1),f("Timeout cleared"))};requestAnimationFrame=function(a){e=a}})();return{start:function(){g=!0},capture:function(a){g&&(j.add(a),f("Frame saved"));n(k)},stop:function(){g=!1},save:function(){var a=j.compile();return(window.webkitURL||window.URL).createObjectURL(a)}}};
