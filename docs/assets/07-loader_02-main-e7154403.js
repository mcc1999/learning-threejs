import"./modulepreload-polyfill-3cfb730f.js";import{a5 as I,a6 as P,aD as x,aE as v,f as E,g as O,h as A,aF as B,F as H,R as W,O as j,V as D,aG as N,T as q,aH as z,S as V,P as $,W as J,e as X,A as Y,G as Z}from"./three.module-26828fde.js";import{O as K}from"./OrbitControls-2d8a967e.js";import{G as Q}from"./GLTFLoader-77a8755b.js";import{O as ee}from"./OBJLoader-c0e6a713.js";import{B as T}from"./index-969f7968.js";/* empty css              */const C=new WeakMap;class te extends I{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,a,t){const o=new P(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,s=>{this.parse(s,i,t)},a,t)}parse(e,i,a){this.decodeDracoFile(e,i,null,null,x).catch(a)}decodeDracoFile(e,i,a,t,o=v){const s={attributeIDs:a||this.defaultAttributeIDs,attributeTypes:t||this.defaultAttributeTypes,useUniqueIDs:!!a,vertexColorSpace:o};return this.decodeGeometry(e,s).then(i)}decodeGeometry(e,i){const a=JSON.stringify(i);if(C.has(e)){const r=C.get(e);if(r.key===a)return r.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let t;const o=this.workerNextTaskID++,s=e.byteLength,n=this._getWorker(o,s).then(r=>(t=r,new Promise((c,d)=>{t._callbacks[o]={resolve:c,reject:d},t.postMessage({type:"decode",id:o,taskConfig:i,buffer:e},[e])}))).then(r=>this._createGeometry(r.geometry));return n.catch(()=>!0).then(()=>{t&&o&&this._releaseTask(t,o)}),C.set(e,{key:a,promise:n}),n}_createGeometry(e){const i=new E;e.index&&i.setIndex(new O(e.index.array,1));for(let a=0;a<e.attributes.length;a++){const t=e.attributes[a],o=t.name,s=t.array,n=t.itemSize,r=new O(s,n);o==="color"&&this._assignVertexColorSpace(r,t.vertexColorSpace),i.setAttribute(o,r)}return i}_assignVertexColorSpace(e,i){if(i!==x)return;const a=new A;for(let t=0,o=e.count;t<o;t++)a.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,a.r,a.g,a.b)}_loadLibrary(e,i){const a=new P(this.manager);return a.setPath(this.decoderPath),a.setResponseType(i),a.setWithCredentials(this.withCredentials),new Promise((t,o)=>{a.load(e,t,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(a=>{const t=a[0];e||(this.decoderConfig.wasmBinary=a[1]);const o=se.toString(),s=["/* draco decoder */",t,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(o){const s=o.data;switch(s.type){case"decode":t._callbacks[s.id].resolve(s);break;case"error":t._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort(function(t,o){return t._taskLoad>o._taskLoad?-1:1});const a=this.workerPool[this.workerPool.length-1];return a._taskCosts[e]=i,a._taskLoad+=i,a})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function se(){let p,e;onmessage=function(s){const n=s.data;switch(n.type){case"init":p=n.decoderConfig,e=new Promise(function(d){p.onModuleLoaded=function(h){d({draco:h})},DracoDecoderModule(p)});break;case"decode":const r=n.buffer,c=n.taskConfig;e.then(d=>{const h=d.draco,l=new h.Decoder;try{const u=i(h,l,new Int8Array(r),c),f=u.attributes.map(m=>m.array.buffer);u.index&&f.push(u.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:u},f)}catch(u){console.error(u),self.postMessage({type:"error",id:n.id,error:u.message})}finally{h.destroy(l)}});break}};function i(s,n,r,c){const d=c.attributeIDs,h=c.attributeTypes;let l,u;const f=n.GetEncodedGeometryType(r);if(f===s.TRIANGULAR_MESH)l=new s.Mesh,u=n.DecodeArrayToMesh(r,r.byteLength,l);else if(f===s.POINT_CLOUD)l=new s.PointCloud,u=n.DecodeArrayToPointCloud(r,r.byteLength,l);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!u.ok()||l.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+u.error_msg());const m={index:null,attributes:[]};for(const g in d){const y=self[h[g]];let b,k;if(c.useUniqueIDs)k=d[g],b=n.GetAttributeByUniqueId(l,k);else{if(k=n.GetAttributeId(l,s[d[g]]),k===-1)continue;b=n.GetAttribute(l,k)}const R=t(s,n,l,g,y,b);g==="color"&&(R.vertexColorSpace=c.vertexColorSpace),m.attributes.push(R)}return f===s.TRIANGULAR_MESH&&(m.index=a(s,n,l)),s.destroy(l),m}function a(s,n,r){const d=r.num_faces()*3,h=d*4,l=s._malloc(h);n.GetTrianglesUInt32Array(r,h,l);const u=new Uint32Array(s.HEAPF32.buffer,l,d).slice();return s._free(l),{array:u,itemSize:1}}function t(s,n,r,c,d,h){const l=h.num_components(),f=r.num_points()*l,m=f*d.BYTES_PER_ELEMENT,g=o(s,d),y=s._malloc(m);n.GetAttributeDataArrayForAllPoints(r,h,g,m,y);const b=new d(s.HEAPF32.buffer,y,f).slice();return s._free(y),{name:c,array:b,itemSize:l}}function o(s,n){switch(n){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}class re extends I{constructor(e){super(e)}load(e,i,a,t){const o=this,s=this.path===""?B.extractUrlBase(e):this.path,n=new P(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(r){try{i(o.parse(r,s))}catch(c){t?t(c):console.error(c),o.manager.itemError(e)}},a,t)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const a=e.split(`
`);let t={};const o=/\s+/,s={};for(let r=0;r<a.length;r++){let c=a[r];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const d=c.indexOf(" ");let h=d>=0?c.substring(0,d):c;h=h.toLowerCase();let l=d>=0?c.substring(d+1):"";if(l=l.trim(),h==="newmtl")t={name:l},s[l]=t;else if(h==="ka"||h==="kd"||h==="ks"||h==="ke"){const u=l.split(o,3);t[h]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else t[h]=l}const n=new oe(this.resourcePath||i,this.materialOptions);return n.setCrossOrigin(this.crossOrigin),n.setManager(this.manager),n.setMaterials(s),n}}class oe{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:H,this.wrap=this.options.wrap!==void 0?this.options.wrap:W}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const a in e){const t=e[a],o={};i[a]=o;for(const s in t){let n=!0,r=t[s];const c=s.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&r[0]===0&&r[1]===0&&r[2]===0&&(n=!1);break}n&&(o[c]=r)}}return i}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const i=this,a=this.materialsInfo[e],t={name:e,side:this.side};function o(n,r){return typeof r!="string"||r===""?"":/^https?:\/\//i.test(r)?r:n+r}function s(n,r){if(t[n])return;const c=i.getTextureParams(r,t),d=i.loadTexture(o(i.baseUrl,c.url));d.repeat.copy(c.scale),d.offset.copy(c.offset),d.wrapS=i.wrap,d.wrapT=i.wrap,(n==="map"||n==="emissiveMap")&&(d.encoding=z),t[n]=d}for(const n in a){const r=a[n];let c;if(r!=="")switch(n.toLowerCase()){case"kd":t.color=new A().fromArray(r).convertSRGBToLinear();break;case"ks":t.specular=new A().fromArray(r).convertSRGBToLinear();break;case"ke":t.emissive=new A().fromArray(r).convertSRGBToLinear();break;case"map_kd":s("map",r);break;case"map_ks":s("specularMap",r);break;case"map_ke":s("emissiveMap",r);break;case"norm":s("normalMap",r);break;case"map_bump":case"bump":s("bumpMap",r);break;case"map_d":s("alphaMap",r),t.transparent=!0;break;case"ns":t.shininess=parseFloat(r);break;case"d":c=parseFloat(r),c<1&&(t.opacity=c,t.transparent=!0);break;case"tr":c=parseFloat(r),this.options&&this.options.invertTrProperty&&(c=1-c),c>0&&(t.opacity=1-c,t.transparent=!0);break}}return this.materials[e]=new j(t),this.materials[e]}getTextureParams(e,i){const a={scale:new D(1,1),offset:new D(0,0)},t=e.split(/\s+/);let o;return o=t.indexOf("-bm"),o>=0&&(i.bumpScale=parseFloat(t[o+1]),t.splice(o,2)),o=t.indexOf("-s"),o>=0&&(a.scale.set(parseFloat(t[o+1]),parseFloat(t[o+2])),t.splice(o,4)),o=t.indexOf("-o"),o>=0&&(a.offset.set(parseFloat(t[o+1]),parseFloat(t[o+2])),t.splice(o,4)),a.url=t.join(" ").trim(),a}loadTexture(e,i,a,t,o){const s=this.manager!==void 0?this.manager:N;let n=s.getHandler(e);n===null&&(n=new q(s)),n.setCrossOrigin&&n.setCrossOrigin(this.crossOrigin);const r=n.load(e,a,t,o);return i!==void 0&&(r.mapping=i),r}}const w=new V,L=new $(75,window.innerWidth/window.innerHeight,.1,1e3);L.position.set(15,15,15);const M=new Q,U=new te;U.setDecoderPath(`${T}draco/gltf`);M.setDRACOLoader(U);M.load(`${T}models/cube.glb`,p=>{const e=p.scene;e.position.set(0,0,0),w.add(e)});const S=new ee,ne=new re;ne.load(`${T}models/lego.mtl`,p=>{p.preload(),S.setMaterials(p),S.load(`${T}models/lego.obj`,e=>{e.position.set(5,0,0),w.add(e)})});const _=new J;_.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(_.domElement);window.addEventListener("resize",()=>{L.aspect=window.innerWidth/window.innerHeight,L.updateProjectionMatrix(),_.setSize(window.innerWidth,window.innerHeight)});const ie=new X(16777215,.5);w.add(ie);const ae=new Y(1e3);w.add(ae);const ce=new Z(100,10);w.add(ce);const F=new K(L,_.domElement);F.enableDamping=!0;function G(){requestAnimationFrame(G),F.update(),_.render(w,L)}G();
